class t{static fromString(e){return new t(e)}constructor(e){this.value=e}icaltype="binary";decodeValue(){return this._b64_decode(this.value)}setEncodedValue(e){this.value=this._b64_encode(e)}_b64_encode(e){let o,u,b,w,x,v,N,I,M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",L=0,P=0,U="",V=[];if(!e)return e;do{o=e.charCodeAt(L++),u=e.charCodeAt(L++),b=e.charCodeAt(L++),I=o<<16|u<<8|b,w=I>>18&63,x=I>>12&63,v=I>>6&63,N=63&I,V[P++]=M.charAt(w)+M.charAt(x)+M.charAt(v)+M.charAt(N)}while(L<e.length);U=V.join("");let H=e.length%3;return(H?U.slice(0,H-3):U)+"===".slice(H||3)}_b64_decode(e){let o,u,b,w,x,v,N,I,M="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",L=0,P=0,U="",V=[];if(!e)return e;e+="";do{w=M.indexOf(e.charAt(L++)),x=M.indexOf(e.charAt(L++)),v=M.indexOf(e.charAt(L++)),N=M.indexOf(e.charAt(L++)),I=w<<18|x<<12|v<<6|N,o=I>>16&255,u=I>>8&255,b=255&I,V[P++]=64==v?String.fromCharCode(o):64==N?String.fromCharCode(o,u):String.fromCharCode(o,u,b)}while(L<e.length);return U=V.join(""),U}toString(){return this.value}}const e=/([PDWHMTS]{1,1})/,o=["weeks","days","hours","minutes","seconds","isNegative"];class r{static fromSeconds(e){return(new r).fromSeconds(e)}static isValueString(e){return"P"===e[0]||"P"===e[1]}static fromString(o){let u=0,b=Object.create(null),w=0;for(;-1!==(u=o.search(e));){let e=o[u],x=o.slice(0,Math.max(0,u));o=o.slice(u+1),w+=n(e,x,b)}if(w<2)throw new Error('invalid duration value: Not enough duration components in "'+o+'"');return new r(b)}static fromData(e){return new r(e)}constructor(e){this.wrappedJSObject=this,this.fromData(e)}weeks=0;days=0;hours=0;minutes=0;seconds=0;isNegative=!1;icalclass="icalduration";icaltype="duration";clone(){return r.fromData(this)}toSeconds(){let e=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+604800*this.weeks;return this.isNegative?-e:e}fromSeconds(e){let o=Math.abs(e);return this.isNegative=e<0,this.days=A(o/86400),this.days%7==0?(this.weeks=this.days/7,this.days=0):this.weeks=0,o-=86400*(this.days+7*this.weeks),this.hours=A(o/3600),o-=3600*this.hours,this.minutes=A(o/60),o-=60*this.minutes,this.seconds=o,this}fromData(e){for(let u of o)this[u]=e&&u in e?e[u]:0}reset(){this.isNegative=!1,this.weeks=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0}compare(e){let o=this.toSeconds(),u=e.toSeconds();return(o>u)-(o<u)}normalize(){this.fromSeconds(this.toSeconds())}toString(){if(0==this.toSeconds())return"PT0S";{let e="";return this.isNegative&&(e+="-"),e+="P",this.weeks&&(e+=this.weeks+"W"),this.days&&(e+=this.days+"D"),(this.hours||this.minutes||this.seconds)&&(e+="T",this.hours&&(e+=this.hours+"H"),this.minutes&&(e+=this.minutes+"M"),this.seconds&&(e+=this.seconds+"S")),e}}toICALString(){return this.toString()}}function n(e,o,u){let b;switch(e){case"P":u.isNegative=!(!o||"-"!==o);break;case"D":b="days";break;case"W":b="weeks";break;case"H":b="hours";break;case"M":b="minutes";break;case"S":b="seconds";break;default:return 0}if(b){if(!o&&0!==o)throw new Error('invalid duration value: Missing number before "'+e+'"');let w=parseInt(o,10);if(f(w))throw new Error('invalid duration value: Invalid number "'+o+'" before "'+e+'"');u[b]=w}return 1}class s{static _dowCache={};static _wnCache={};static daysInMonth(e,o){let u=30;return e<1||e>12||(u=[0,31,28,31,30,31,30,31,31,30,31,30,31][e],2==e&&(u+=s.isLeapYear(o))),u}static isLeapYear(e){return e<=1752?e%4==0:e%4==0&&e%100!=0||e%400==0}static fromDayOfYear(e,o){let u=o,b=e,w=new s;w.auto_normalize=!1;let x=s.isLeapYear(u)?1:0;if(b<1)return u--,x=s.isLeapYear(u)?1:0,b+=s.daysInYearPassedMonth[x][12],s.fromDayOfYear(b,u);if(b>s.daysInYearPassedMonth[x][12])return x=s.isLeapYear(u)?1:0,b-=s.daysInYearPassedMonth[x][12],u++,s.fromDayOfYear(b,u);w.year=u,w.isDate=!0;for(let e=11;e>=0;e--)if(b>s.daysInYearPassedMonth[x][e]){w.month=e+1,w.day=b-s.daysInYearPassedMonth[x][e];break}return w.auto_normalize=!0,w}static fromStringv2(e){return new s({year:parseInt(e.slice(0,4),10),month:parseInt(e.slice(5,7),10),day:parseInt(e.slice(8,10),10),isDate:!0})}static fromDateString(e){return new s({year:p(e.slice(0,4)),month:p(e.slice(5,7)),day:p(e.slice(8,10)),isDate:!0})}static fromDateTimeString(e,o){if(e.length<19)throw new Error('invalid date-time value: "'+e+'"');let u,b;e[19]&&"Z"===e[19]?u=c.utcTimezone:o&&(b=o.getParameter("tzid"),o.parent&&("standard"===o.parent.name||"daylight"===o.parent.name?u=c.localTimezone:b&&(u=o.parent.getTimeZoneByID(b))));const w={year:p(e.slice(0,4)),month:p(e.slice(5,7)),day:p(e.slice(8,10)),hour:p(e.slice(11,13)),minute:p(e.slice(14,16)),second:p(e.slice(17,19))};return b&&!u&&(w.timezone=b),new s(w,u)}static fromString(e,o){return e.length>10?s.fromDateTimeString(e,o):s.fromDateString(e)}static fromJSDate(e,o){return(new s).fromJSDate(e,o)}static fromData=function(e,o){return(new s).fromData(e,o)};static now(){return s.fromJSDate(new Date,!1)}static weekOneStarts(e,o){let u=s.fromData({year:e,month:1,day:1,isDate:!0}),b=u.dayOfWeek(),w=o||s.DEFAULT_WEEK_START;return b>s.THURSDAY&&(u.day+=7),w>s.THURSDAY&&(u.day-=7),u.day-=b-w,u}static getDominicalLetter(e){let o="GFEDCBA",u=(e+(e/4|0)+(e/400|0)-(e/100|0)-1)%7;return s.isLeapYear(e)?o[(u+6)%7]+o[u]:o[u]}static#t=null;static get epochTime(){return this.#t||(this.#t=s.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:!1,timezone:"Z"})),this.#t}static _cmp_attr(e,o,u){return e[u]>o[u]?1:e[u]<o[u]?-1:0}static daysInYearPassedMonth=[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]];static SUNDAY=1;static MONDAY=2;static TUESDAY=3;static WEDNESDAY=4;static THURSDAY=5;static FRIDAY=6;static SATURDAY=7;static DEFAULT_WEEK_START=2;constructor(e,o){this.wrappedJSObject=this;let u=this._time=Object.create(null);u.year=0,u.month=1,u.day=1,u.hour=0,u.minute=0,u.second=0,u.isDate=!1,this.fromData(e,o)}icalclass="icaltime";_cachedUnixTime=null;get icaltype(){return this.isDate?"date":"date-time"}zone=null;_pendingNormalization=!1;clone(){return new s(this._time,this.zone)}reset(){this.fromData(s.epochTime),this.zone=c.utcTimezone}resetTo(e,o,u,b,w,x,v){this.fromData({year:e,month:o,day:u,hour:b,minute:w,second:x,zone:v})}fromJSDate(e,o){return e?o?(this.zone=c.utcTimezone,this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()):(this.zone=c.localTimezone,this.year=e.getFullYear(),this.month=e.getMonth()+1,this.day=e.getDate(),this.hour=e.getHours(),this.minute=e.getMinutes(),this.second=e.getSeconds()):this.reset(),this._cachedUnixTime=null,this}fromData(e,o){if(e)for(let[o,u]of Object.entries(e))"icaltype"!==o&&(this[o]=u);if(o&&(this.zone=o),e&&!("isDate"in e)?this.isDate=!("hour"in e):e&&"isDate"in e&&(this.isDate=e.isDate),e&&"timezone"in e){let o=v.get(e.timezone);this.zone=o||c.localTimezone}return e&&"zone"in e&&(this.zone=e.zone),this.zone||(this.zone=c.localTimezone),this._cachedUnixTime=null,this}dayOfWeek(e){let o=e||s.SUNDAY,u=(this.year<<12)+(this.month<<8)+(this.day<<3)+o;if(u in s._dowCache)return s._dowCache[u];let b=this.day,w=this.month+(this.month<3?12:0),x=this.year-(this.month<3?1:0),v=b+x+A(26*(w+1)/10)+A(x/4);return v+=6*A(x/100)+A(x/400),v=(v+7-o)%7+1,s._dowCache[u]=v,v}dayOfYear(){let e=s.isLeapYear(this.year)?1:0;return s.daysInYearPassedMonth[e][this.month-1]+this.day}startOfWeek(e){let o=e||s.SUNDAY,u=this.clone();return u.day-=(this.dayOfWeek()+7-o)%7,u.isDate=!0,u.hour=0,u.minute=0,u.second=0,u}endOfWeek(e){let o=e||s.SUNDAY,u=this.clone();return u.day+=(7-this.dayOfWeek()+o-s.SUNDAY)%7,u.isDate=!0,u.hour=0,u.minute=0,u.second=0,u}startOfMonth(){let e=this.clone();return e.day=1,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}endOfMonth(){let e=this.clone();return e.day=s.daysInMonth(e.month,e.year),e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}startOfYear(){let e=this.clone();return e.day=1,e.month=1,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}endOfYear(){let e=this.clone();return e.day=31,e.month=12,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}startDoyWeek(e){let o=e||s.SUNDAY,u=this.dayOfWeek()-o;return u<0&&(u+=7),this.dayOfYear()-u}getDominicalLetter(){return s.getDominicalLetter(this.year)}nthWeekDay(e,o){let u,b=s.daysInMonth(this.month,this.year),w=o,x=0,v=this.clone();if(w>=0){v.day=1,0!=w&&w--,x=v.day;let o=e-v.dayOfWeek();o<0&&(o+=7),x+=o,x-=e,u=e}else v.day=b,w++,u=v.dayOfWeek()-e,u<0&&(u+=7),u=b-u;return u+=7*w,x+u}isNthWeekDay(e,o){let u=this.dayOfWeek();return 0===o&&u===e||this.nthWeekDay(e,o)===this.day}weekNumber(e){let o,u=(this.year<<12)+(this.month<<8)+(this.day<<3)+e;if(u in s._wnCache)return s._wnCache[u];let b=this.clone();b.isDate=!0;let w=this.year;12==b.month&&b.day>25?(o=s.weekOneStarts(w+1,e),b.compare(o)<0?o=s.weekOneStarts(w,e):w++):(o=s.weekOneStarts(w,e),b.compare(o)<0&&(o=s.weekOneStarts(--w,e)));let x=A(b.subtractDate(o).toSeconds()/86400/7)+1;return s._wnCache[u]=x,x}addDuration(e){let o=e.isNegative?-1:1,u=this.second,b=this.minute,w=this.hour,x=this.day;u+=o*e.seconds,b+=o*e.minutes,w+=o*e.hours,x+=o*e.days,x+=7*o*e.weeks,this.second=u,this.minute=b,this.hour=w,this.day=x,this._cachedUnixTime=null}subtractDate(e){let o=this.toUnixTime()+this.utcOffset(),u=e.toUnixTime()+e.utcOffset();return r.fromSeconds(o-u)}subtractDateTz(e){let o=this.toUnixTime(),u=e.toUnixTime();return r.fromSeconds(o-u)}compare(e){let o=this.toUnixTime(),u=e.toUnixTime();return o>u?1:u>o?-1:0}compareDateOnlyTz(e,o){let u=this.convertToZone(o),b=e.convertToZone(o),w=0;return 0!=(w=s._cmp_attr(u,b,"year"))||0!=(w=s._cmp_attr(u,b,"month"))||(w=s._cmp_attr(u,b,"day")),w}convertToZone(e){let o=this.clone(),u=this.zone.tzid==e.tzid;return this.isDate||u||c.convert_time(o,this.zone,e),o.zone=e,o}utcOffset(){return this.zone==c.localTimezone||this.zone==c.utcTimezone?0:this.zone.utcOffset(this)}toICALString(){let e=this.toString();return e.length>10?Yt.icalendar.value["date-time"].toICAL(e):Yt.icalendar.value.date.toICAL(e)}toString(){let e=this.year+"-"+Y(this.month)+"-"+Y(this.day);return this.isDate||(e+="T"+Y(this.hour)+":"+Y(this.minute)+":"+Y(this.second),this.zone===c.utcTimezone&&(e+="Z")),e}toJSDate(){return this.zone==c.localTimezone?this.isDate?new Date(this.year,this.month-1,this.day):new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0):new Date(1e3*this.toUnixTime())}_normalize(){return this._time.isDate&&(this._time.hour=0,this._time.minute=0,this._time.second=0),this.adjust(0,0,0,0),this}adjust(e,o,u,b,w){let x,v,N,I,M,L,P,U=0,V=0,H=w||this._time;if(H.isDate||(N=H.second+b,H.second=N%60,x=A(N/60),H.second<0&&(H.second+=60,x--),I=H.minute+u+x,H.minute=I%60,v=A(I/60),H.minute<0&&(H.minute+=60,v--),M=H.hour+o+v,H.hour=M%24,U=A(M/24),H.hour<0&&(H.hour+=24,U--)),H.month>12?V=A((H.month-1)/12):H.month<1&&(V=A(H.month/12)-1),H.year+=V,H.month-=12*V,L=H.day+e+U,L>0)for(;P=s.daysInMonth(H.month,H.year),!(L<=P);)H.month++,H.month>12&&(H.year++,H.month=1),L-=P;else for(;L<=0;)1==H.month?(H.year--,H.month=12):H.month--,L+=s.daysInMonth(H.month,H.year);return H.day=L,this._cachedUnixTime=null,this}fromUnixTime(e){this.zone=c.utcTimezone;let o=new Date(1e3*e);this.year=o.getUTCFullYear(),this.month=o.getUTCMonth()+1,this.day=o.getUTCDate(),this._time.isDate?(this.hour=0,this.minute=0,this.second=0):(this.hour=o.getUTCHours(),this.minute=o.getUTCMinutes(),this.second=o.getUTCSeconds()),this._cachedUnixTime=null}toUnixTime(){if(null!==this._cachedUnixTime)return this._cachedUnixTime;let e=this.utcOffset(),o=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-e);return this._cachedUnixTime=o/1e3,this._cachedUnixTime}toJSON(){let e,o=["year","month","day","hour","minute","second","isDate"],u=Object.create(null),b=0,w=o.length;for(;b<w;b++)e=o[b],u[e]=this[e];return this.zone&&(u.timezone=this.zone.tzid),u}}!function(){function t(e){Object.defineProperty(s.prototype,e,{get:function(){return this._pendingNormalization&&(this._normalize(),this._pendingNormalization=!1),this._time[e]},set:function(o){"isDate"===e&&o&&!this._time.isDate&&this.adjust(0,0,0,0),this._cachedUnixTime=null,this._pendingNormalization=!0,this._time[e]=o}})}t("year"),t("month"),t("day"),t("hour"),t("minute"),t("second"),t("isDate")}();const u=/[^ \t]/,b={"^'":'"',"^n":"\n","^^":"^"};function l(e){let o={},u=o.component=[];if(o.stack=[u],l._eachLine(e,(function(e,u){l._handleContentLine(u,o)})),o.stack.length>1)throw new h("invalid ical body. component began but did not end");return o=null,1==u.length?u[0]:u}l.property=function(e,o){let u={component:[[],[]],designSet:o||Yt.defaultSet};return l._handleContentLine(e,u),u.component[1][0]},l.component=function(e){return l(e)};class h extends Error{constructor(e){super(e),this.name=this.constructor.name;try{throw new Error}catch(e){if(e.stack){let o=e.stack.split("\n");o.shift(),this.stack=o.join("\n")}}}}l.ParserError=h,l._handleContentLine=function(e,o){let u,b,w,x,v,N,I=e.indexOf(":"),M=e.indexOf(";"),L={};if(-1!==M&&-1!==I&&M>I&&(M=-1),-1!==M){if(w=e.slice(0,Math.max(0,M)).toLowerCase(),v=l._parseParameters(e.slice(Math.max(0,M)),0,o.designSet),-1==v[2])throw new h("Invalid parameters in '"+e+"'");if(L=v[0],u=v[1].length+v[2]+M,-1===(b=e.slice(Math.max(0,u)).indexOf(":")))throw new h("Missing parameter value in '"+e+"'");x=e.slice(Math.max(0,u+b+1))}else{if(-1===I)throw new h('invalid line (no token ";" or ":") "'+e+'"');if(w=e.slice(0,Math.max(0,I)).toLowerCase(),x=e.slice(Math.max(0,I+1)),"begin"===w){let e=[x.toLowerCase(),[],[]];return 1===o.stack.length?o.component.push(e):o.component[2].push(e),o.stack.push(o.component),o.component=e,void(o.designSet||(o.designSet=Yt.getDesignSet(o.component[0])))}if("end"===w)return void(o.component=o.stack.pop())}let P,U,V,H,R=!1,W=!1;o.designSet.propertyGroups&&-1!==w.indexOf(".")?(U=w.split("."),L.group=U[0],V=U[1]):V=w,V in o.designSet.property&&(P=o.designSet.property[V],"multiValue"in P&&(R=P.multiValue),"structuredValue"in P&&(W=P.structuredValue),x&&"detectType"in P&&(N=P.detectType(x))),N||(N="value"in L?L.value.toLowerCase():P?P.defaultType:"unknown"),delete L.value,R&&W?(x=l._parseMultiValue(x,W,N,[],R,o.designSet,W),H=[V,L,N,x]):R?(H=[V,L,N],l._parseMultiValue(x,R,N,H,null,o.designSet,!1)):W?(x=l._parseMultiValue(x,W,N,[],null,o.designSet,W),H=[V,L,N,x]):(x=l._parseValue(x,N,o.designSet,!1),H=[V,L,N,x]),"vcard"!==o.component[0]||0!==o.component[1].length||"version"===w&&"4.0"===x||(o.designSet=Yt.getDesignSet("vcard3")),o.component[1].push(H)},l._parseValue=function(e,o,u,b){return o in u.value&&"fromICAL"in u.value[o]?u.value[o].fromICAL(e,b):e},l._parseParameters=function(e,o,u){let b,w,x,v,N,I,M=o,L=0,P={},U=-1;for(;!1!==L&&-1!==(L=_(e,"=",L+1));){if(b=e.slice(M+1,L),0==b.length)throw new h("Empty parameter name in '"+e+"'");if(w=b.toLowerCase(),I=!1,N=!1,v=w in u.param&&u.param[w].valueType?u.param[w].valueType:"text",w in u.param&&(N=u.param[w].multiValue,u.param[w].multiValueSeparateDQuote&&(I=l._rfc6868Escape('"'+N+'"'))),'"'===e[L+1]){if(U=L+2,L=_(e,'"',U),N&&-1!=L){let o=!0;for(;o;)e[L+1]==N&&'"'==e[L+2]?L=_(e,'"',L+3):o=!1}if(-1===L)throw new h('invalid line (no matching double quote) "'+e+'"');x=e.slice(U,L),M=_(e,";",L),-1===M&&(L=!1)}else{U=L+1;let o=_(e,";",U),u=_(e,":",U);-1!==u&&o>u?(o=u,L=!1):-1===o?(o=-1===u?e.length:u,L=!1):(M=o,L=o),x=e.slice(U,o)}if(x=l._rfc6868Escape(x),N){let e=I||N;x=l._parseMultiValue(x,e,v,[],null,u)}else x=l._parseValue(x,v,u);N&&w in P?Array.isArray(P[w])?P[w].push(x):P[w]=[P[w],x]:P[w]=x}return[P,x,U]},l._rfc6868Escape=function(e){return e.replace(/\^['n^]/g,(function(e){return b[e]}))},l._parseMultiValue=function(e,o,u,b,w,x,v){let N,I=0,M=0;if(0===o.length)return e;for(;-1!==(I=_(e,o,M));)N=e.slice(M,I),N=w?l._parseMultiValue(N,w,u,[],null,x,v):l._parseValue(N,u,x,v),b.push(N),M=I+o.length;return N=e.slice(M),N=w?l._parseMultiValue(N,w,u,[],null,x,v):l._parseValue(N,u,x,v),b.push(N),1==b.length?b[0]:b},l._eachLine=function(e,o){let b,w,x,v=e.length,N=e.search(u),I=N;do{I=e.indexOf("\n",N)+1,x=I>1&&"\r"===e[I-2]?2:1,0===I&&(I=v,x=0),w=e[N]," "===w||"\t"===w?b+=e.slice(N+1,I-x):(b&&o(null,b),b=e.slice(N,I-x)),N=I}while(I!==v);b=b.trim(),b.length&&o(null,b)};const w=["tzid","location","tznames","latitude","longitude"];class c{static _compare_change_fn(e,o){return e.year<o.year?-1:e.year>o.year?1:e.month<o.month?-1:e.month>o.month?1:e.day<o.day?-1:e.day>o.day?1:e.hour<o.hour?-1:e.hour>o.hour?1:e.minute<o.minute?-1:e.minute>o.minute?1:e.second<o.second?-1:e.second>o.second?1:0}static convert_time(e,o,u){if(e.isDate||o.tzid==u.tzid||o==c.localTimezone||u==c.localTimezone)return e.zone=u,e;let b=o.utcOffset(e);return e.adjust(0,0,0,-b),b=u.utcOffset(e),e.adjust(0,0,0,b),null}static fromData(e){return(new c).fromData(e)}static#e=null;static get utcTimezone(){return this.#e||(this.#e=c.fromData({tzid:"UTC"})),this.#e}static#i=null;static get localTimezone(){return this.#i||(this.#i=c.fromData({tzid:"floating"})),this.#i}static adjust_change(e,o,u,b,w){return s.prototype.adjust.call(e,o,u,b,w,e)}static _minimumExpansionYear=-1;static EXTRA_COVERAGE=5;constructor(e){this.wrappedJSObject=this,this.fromData(e)}tzid="";location="";tznames="";latitude=0;longitude=0;component=null;expandedUntilYear=0;icalclass="icaltimezone";fromData(e){if(this.expandedUntilYear=0,this.changes=[],e instanceof yt)this.component=e;else{if(e&&"component"in e)if("string"==typeof e.component){let o=l(e.component);this.component=new yt(o)}else e.component instanceof yt?this.component=e.component:this.component=null;for(let o of w)e&&o in e&&(this[o]=e[o])}return this.component instanceof yt&&!this.tzid&&(this.tzid=this.component.getFirstPropertyValue("tzid")),this}utcOffset(e){if(this==c.utcTimezone||this==c.localTimezone)return 0;if(this._ensureCoverage(e.year),!this.changes.length)return 0;let o={year:e.year,month:e.month,day:e.day,hour:e.hour,minute:e.minute,second:e.second},u=this._findNearbyChange(o),b=-1,w=1;for(;;){let e=D(this.changes[u],!0);if(e.utcOffset<e.prevUtcOffset?c.adjust_change(e,0,0,0,e.utcOffset):c.adjust_change(e,0,0,0,e.prevUtcOffset),c._compare_change_fn(o,e)>=0?b=u:w=-1,-1==w&&-1!=b)break;if(u+=w,u<0)return 0;if(u>=this.changes.length)break}let x=this.changes[b];if(x.utcOffset-x.prevUtcOffset<0&&b>0){let e=D(x,!0);if(c.adjust_change(e,0,0,0,e.prevUtcOffset),c._compare_change_fn(o,e)<0){let e=this.changes[b-1],o=!1;x.is_daylight!=o&&e.is_daylight==o&&(x=e)}}return x.utcOffset}_findNearbyChange(e){let o=g(this.changes,e,c._compare_change_fn);return o>=this.changes.length?this.changes.length-1:o}_ensureCoverage(e){if(-1==c._minimumExpansionYear){let e=s.now();c._minimumExpansionYear=e.year}let o=e;if(o<c._minimumExpansionYear&&(o=c._minimumExpansionYear),o+=c.EXTRA_COVERAGE,!this.changes.length||this.expandedUntilYear<e){let e=this.component.getAllSubcomponents(),u=e.length,b=0;for(;b<u;b++)this._expandComponent(e[b],o,this.changes);this.changes.sort(c._compare_change_fn),this.expandedUntilYear=o}}_expandComponent(e,o,u){if(!e.hasProperty("dtstart")||!e.hasProperty("tzoffsetto")||!e.hasProperty("tzoffsetfrom"))return null;let b,w=e.getFirstProperty("dtstart").getFirstValue();function s(e){return e.factor*(3600*e.hours+60*e.minutes)}function a(){let o={};return o.is_daylight="daylight"==e.name,o.utcOffset=s(e.getFirstProperty("tzoffsetto").getFirstValue()),o.prevUtcOffset=s(e.getFirstProperty("tzoffsetfrom").getFirstValue()),o}if(e.hasProperty("rrule")||e.hasProperty("rdate")){let x=e.getAllProperties("rdate");for(let e of x){let o=e.getFirstValue();b=a(),b.year=o.year,b.month=o.month,b.day=o.day,o.isDate?(b.hour=w.hour,b.minute=w.minute,b.second=w.second,w.zone!=c.utcTimezone&&c.adjust_change(b,0,0,0,-b.prevUtcOffset)):(b.hour=o.hour,b.minute=o.minute,b.second=o.second,o.zone!=c.utcTimezone&&c.adjust_change(b,0,0,0,-b.prevUtcOffset)),u.push(b)}let v=e.getFirstProperty("rrule");if(v){v=v.getFirstValue(),b=a(),v.until&&v.until.zone==c.utcTimezone&&(v.until.adjust(0,0,0,b.prevUtcOffset),v.until.zone=c.localTimezone);let e,x=v.iterator(w);for(;(e=x.next())&&(b=a(),!(e.year>o)&&e);)b.year=e.year,b.month=e.month,b.day=e.day,b.hour=e.hour,b.minute=e.minute,b.second=e.second,b.isDate=e.isDate,c.adjust_change(b,0,0,0,-b.prevUtcOffset),u.push(b)}}else b=a(),b.year=w.year,b.month=w.month,b.day=w.day,b.hour=w.hour,b.minute=w.minute,b.second=w.second,c.adjust_change(b,0,0,0,-b.prevUtcOffset),u.push(b);return u}toString(){return this.tznames?this.tznames:this.tzid}}let x=null;const v={get count(){return null===x?0:Object.keys(x).length},reset:function(){x=Object.create(null);let e=c.utcTimezone;x.Z=e,x.UTC=e,x.GMT=e},has:function(e){return null!==x&&!!x[e]},get:function(e){return null===x&&this.reset(),x[e]},register:function(e,o){if(null===x&&this.reset(),e instanceof yt&&"vtimezone"===e.name&&(e=(o=new c(e)).tzid),!(o instanceof c))throw new TypeError("timezone must be ICAL.Timezone or ICAL.Component");x[e]=o},remove:function(e){return null===x?null:delete x[e]}};function f(e){return"number"==typeof e&&isNaN(e)}function p(e){let o=parseInt(e,10);if(f(o))throw new Error('Could not extract integer from "'+e+'"');return o}function y(e,o){if(void 0!==e)return e instanceof o?e:new o(e)}function _(e,o,u){for(;-1!==(u=e.indexOf(o,u));){if(!(u>0&&"\\"===e[u-1]))return u;u+=1}return-1}function g(e,o,u){if(!e.length)return 0;let b,w,x=0,v=e.length-1;for(;x<=v;)if(b=x+Math.floor((v-x)/2),w=u(o,e[b]),w<0)v=b-1;else{if(!(w>0))break;x=b+1}return w<0?b:w>0?b+1:b}function D(e,o){if(e&&"object"==typeof e){if(e instanceof Date)return new Date(e.getTime());if("clone"in e)return e.clone();if(Array.isArray(e)){let u=[];for(let b=0;b<e.length;b++)u.push(o?D(e[b],!0):e[b]);return u}{let u={};for(let[b,w]of Object.entries(e))u[b]=o?D(w,!0):w;return u}}return e}function T(e){let o="",u=e||"",b=0,w=0;for(;u.length;){let e=u.codePointAt(b);e<128?++w:w+=e<2048?2:e<65536?3:4,w<St.foldLength+1?b+=e>65535?2:1:(o+=St.newLineChar+" "+u.slice(0,Math.max(0,b)),u=u.slice(Math.max(0,b)),b=w=0)}return o.slice(St.newLineChar.length+1)}function Y(e){switch("string"!=typeof e&&("number"==typeof e&&(e=parseInt(e)),e=String(e)),e.length){case 0:return"00";case 1:return"0"+e;default:return e}}function A(e){return e<0?Math.ceil(e):Math.floor(e)}function O(e,o){for(let u in e){let b=Object.getOwnPropertyDescriptor(e,u);b&&!Object.getOwnPropertyDescriptor(o,u)&&Object.defineProperty(o,u,b)}return o}var N=Object.freeze({__proto__:null,updateTimezones:function(e){let o,u,b,w,x;if(!e||"vcalendar"!==e.name)return e;for(o=e.getAllSubcomponents(),u=[],b={},x=0;x<o.length;x++)"vtimezone"===o[x].name?b[o[x].getFirstProperty("tzid").getFirstValue()]=o[x]:u=u.concat(o[x].getAllProperties());for(w={},x=0;x<u.length;x++){let e=u[x].getParameter("tzid");e&&(w[e]=!0)}for(let[o,u]of Object.entries(b))w[o]||e.removeSubcomponent(u);for(let o of Object.keys(w))!b[o]&&v.has(o)&&e.addSubcomponent(v.get(o).component);return e},isStrictlyNaN:f,strictParseInt:p,formatClassType:y,unescapedIndexOf:_,binsearchInsert:g,clone:D,foldline:T,pad2:Y,trunc:A,extend:O});class S{static fromString(e){let o={};return o.factor="+"===e[0]?1:-1,o.hours=p(e.slice(1,3)),o.minutes=p(e.slice(4,6)),new S(o)}static fromSeconds(e){let o=new S;return o.fromSeconds(e),o}constructor(e){this.fromData(e)}hours=0;minutes=0;factor=1;icaltype="utc-offset";clone(){return S.fromSeconds(this.toSeconds())}fromData(e){if(e)for(let[o,u]of Object.entries(e))this[o]=u;this._normalize()}fromSeconds(e){let o=Math.abs(e);return this.factor=e<0?-1:1,this.hours=A(o/3600),o-=3600*this.hours,this.minutes=A(o/60),this}toSeconds(){return this.factor*(60*this.minutes+3600*this.hours)}compare(e){let o=this.toSeconds(),u=e.toSeconds();return(o>u)-(u>o)}_normalize(){let e=this.toSeconds(),o=this.factor;for(;e<-43200;)e+=97200;for(;e>50400;)e-=97200;this.fromSeconds(e),0==e&&(this.factor=o)}toICALString(){return Yt.icalendar.value["utc-offset"].toICAL(this.toString())}toString(){return(1==this.factor?"+":"-")+Y(this.hours)+":"+Y(this.minutes)}}class E extends s{static fromDateAndOrTimeString(e,o){function i(e,o,u){return e?p(e.slice(o,o+u)):null}let u=e.split("T"),b=u[0],w=u[1],x=w?Yt.vcard.value.time._splitZone(w):[],v=x[0],N=x[1],I=b?b.length:0,M=N?N.length:0,L=b&&"-"==b[0]&&"-"==b[1],P=N&&"-"==N[0],U={year:L?null:i(b,0,4),month:!L||4!=I&&7!=I?7==I||10==I?i(b,5,2):null:i(b,2,2),day:5==I?i(b,3,2):7==I&&L?i(b,5,2):10==I?i(b,8,2):null,hour:P?null:i(N,0,2),minute:P&&3==M?i(N,1,2):M>4?i(N,P?1:3,2):null,second:4==M?i(N,2,2):6==M?i(N,4,2):8==M?i(N,6,2):null};return v="Z"==v?c.utcTimezone:v&&":"==v[3]?S.fromString(v):null,new E(U,v,o)}constructor(e,o,u){super(e,o),this.icaltype=u||"date-and-or-time"}icalclass="vcardtime";icaltype="date-and-or-time";clone(){return new E(this._time,this.zone,this.icaltype)}_normalize(){return this}utcOffset(){return this.zone instanceof S?this.zone.toSeconds():s.prototype.utcOffset.apply(this,arguments)}toICALString(){return Yt.vcard.value[this.icaltype].toICAL(this.toString())}toString(){let e,o=this.year,u=this.month,b=this.day,w=this.hour,x=this.minute,v=this.second,N=null!==u,I=null!==b,M=null!==w,L=null!==x,P=null!==v,U=(null!==o?Y(o)+(N||I?"-":""):N||I?"--":"")+(N?Y(u):"")+(I?"-"+Y(b):""),V=(M?Y(w):"-")+(M&&L?":":"")+(L?Y(x):"")+(M||L?"":"-")+(L&&P?":":"")+(P?Y(v):"");e=this.zone===c.utcTimezone?"Z":this.zone instanceof S?this.zone.toString():this.zone===c.localTimezone?"":this.zone instanceof c?S.fromSeconds(this.zone.utcOffset(this)).toString():"";switch(this.icaltype){case"time":return V+e;case"date-and-or-time":case"date-time":return U+("--"==V?"":"T"+V+e);case"date":return U}return null}}class C{static _indexMap={BYSECOND:0,BYMINUTE:1,BYHOUR:2,BYDAY:3,BYMONTHDAY:4,BYYEARDAY:5,BYWEEKNO:6,BYMONTH:7,BYSETPOS:8};static _expandMap={SECONDLY:[1,1,1,1,1,1,1,1],MINUTELY:[2,1,1,1,1,1,1,1],HOURLY:[2,2,1,1,1,1,1,1],DAILY:[2,2,2,1,1,1,1,1],WEEKLY:[2,2,2,2,3,3,1,1],MONTHLY:[2,2,2,2,2,3,3,1],YEARLY:[2,2,2,2,2,2,2,2]};static UNKNOWN=0;static CONTRACT=1;static EXPAND=2;static ILLEGAL=3;constructor(e){this.fromData(e)}completed=!1;rule=null;dtstart=null;last=null;occurrence_number=0;by_indices=null;initialized=!1;by_data=null;days=null;days_index=0;fromData(e){if(this.rule=y(e.rule,B),!this.rule)throw new Error("iterator requires a (ICAL.Recur) rule");if(this.dtstart=y(e.dtstart,s),!this.dtstart)throw new Error("iterator requires a (ICAL.Time) dtstart");e.by_data?this.by_data=e.by_data:this.by_data=D(this.rule.parts,!0),e.occurrence_number&&(this.occurrence_number=e.occurrence_number),this.days=e.days||[],e.last&&(this.last=y(e.last,s)),this.by_indices=e.by_indices,this.by_indices||(this.by_indices={BYSECOND:0,BYMINUTE:0,BYHOUR:0,BYDAY:0,BYMONTH:0,BYWEEKNO:0,BYMONTHDAY:0}),this.initialized=e.initialized||!1,this.initialized||this.init()}init(){this.initialized=!0,this.last=this.dtstart.clone();let e=this.by_data;if("BYDAY"in e&&this.sort_byday_rules(e.BYDAY),"BYYEARDAY"in e&&("BYMONTH"in e||"BYWEEKNO"in e||"BYMONTHDAY"in e||"BYDAY"in e))throw new Error("Invalid BYYEARDAY rule");if("BYWEEKNO"in e&&"BYMONTHDAY"in e)throw new Error("BYWEEKNO does not fit to BYMONTHDAY");if("MONTHLY"==this.rule.freq&&("BYYEARDAY"in e||"BYWEEKNO"in e))throw new Error("For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear");if("WEEKLY"==this.rule.freq&&("BYYEARDAY"in e||"BYMONTHDAY"in e))throw new Error("For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear");if("YEARLY"!=this.rule.freq&&"BYYEARDAY"in e)throw new Error("BYYEARDAY may only appear in YEARLY rules");this.last.second=this.setup_defaults("BYSECOND","SECONDLY",this.dtstart.second),this.last.minute=this.setup_defaults("BYMINUTE","MINUTELY",this.dtstart.minute),this.last.hour=this.setup_defaults("BYHOUR","HOURLY",this.dtstart.hour);let o=this.last.day=this.setup_defaults("BYMONTHDAY","DAILY",this.dtstart.day);if(this.last.month=this.setup_defaults("BYMONTH","MONTHLY",this.dtstart.month),"WEEKLY"==this.rule.freq)if("BYDAY"in e){let[,o]=this.ruleDayOfWeek(e.BYDAY[0],this.rule.wkst),u=o-this.last.dayOfWeek(this.rule.wkst);(this.last.dayOfWeek(this.rule.wkst)<o&&u>=0||u<0)&&(this.last.day+=u)}else{let o=B.numericDayToIcalDay(this.dtstart.dayOfWeek());e.BYDAY=[o]}if("YEARLY"==this.rule.freq){for(;this.expand_year_days(this.last.year),!(this.days.length>0);)this.increment_year(this.rule.interval);this._nextByYearDay()}if("MONTHLY"==this.rule.freq&&this.has_by_data("BYDAY")){let e=null,o=this.last.clone(),u=s.daysInMonth(this.last.month,this.last.year);for(let b of this.by_data.BYDAY){this.last=o.clone();let[w,x]=this.ruleDayOfWeek(b),v=this.last.nthWeekDay(x,w);if(w>=6||w<=-6)throw new Error("Malformed values in BYDAY part");if(v>u||v<=0){if(e&&e.month==o.month)continue;for(;v>u||v<=0;)this.increment_month(),u=s.daysInMonth(this.last.month,this.last.year),v=this.last.nthWeekDay(x,w)}this.last.day=v,(!e||this.last.compare(e)<0)&&(e=this.last.clone())}if(this.last=e.clone(),this.has_by_data("BYMONTHDAY")&&this._byDayAndMonthDay(!0),this.last.day>u||0==this.last.day)throw new Error("Malformed values in BYDAY part")}else if(this.has_by_data("BYMONTHDAY")){this.last.day=1;let e=s.daysInMonth(this.last.month,this.last.year);if(o<0)this.last.day=e+o+1;else if(this.by_data.BYMONTHDAY[0]>e){if(!this.next_month()&&!this.next_month()&&!this.next_month())throw new Error("No possible occurrences")}else this.last.day=o}}next(){let e,o=this.last?this.last.clone():null;if(this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&this.last.compare(this.rule.until)>0)return this.completed=!0,null;if(0==this.occurrence_number&&this.last.compare(this.dtstart)>=0)return this.occurrence_number++,this.last;do{switch(e=1,this.rule.freq){case"SECONDLY":this.next_second();break;case"MINUTELY":this.next_minute();break;case"HOURLY":this.next_hour();break;case"DAILY":this.next_day();break;case"WEEKLY":this.next_week();break;case"MONTHLY":e=this.next_month();break;case"YEARLY":this.next_year();break;default:return null}}while(!this.check_contracting_rules()||this.last.compare(this.dtstart)<0||!e);if(0==this.last.compare(o))throw new Error("Same occurrence found twice, protecting you from death by recursion");return this.rule.until&&this.last.compare(this.rule.until)>0?(this.completed=!0,null):(this.occurrence_number++,this.last)}next_second(){return this.next_generic("BYSECOND","SECONDLY","second","minute")}increment_second(e){return this.increment_generic(e,"second",60,"minute")}next_minute(){return this.next_generic("BYMINUTE","MINUTELY","minute","hour","next_second")}increment_minute(e){return this.increment_generic(e,"minute",60,"hour")}next_hour(){return this.next_generic("BYHOUR","HOURLY","hour","monthday","next_minute")}increment_hour(e){this.increment_generic(e,"hour",24,"monthday")}next_day(){let e="DAILY"==this.rule.freq;return 0==this.next_hour()||(e?this.increment_monthday(this.rule.interval):this.increment_monthday(1)),0}next_week(){let e=0;if(0==this.next_weekday_by_week())return e;if(this.has_by_data("BYWEEKNO")){this.by_indices.BYWEEKNO++,this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length&&(this.by_indices.BYWEEKNO=0,e=1),this.last.month=1,this.last.day=1;let o=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*o,e&&this.increment_year(1)}else this.increment_monthday(7*this.rule.interval);return e}normalizeByMonthDayRules(e,o,u){let b,w=s.daysInMonth(o,e),x=[],v=0,N=u.length;for(;v<N;v++)if(b=u[v],!(Math.abs(b)>w)){if(b<0)b=w+(b+1);else if(0===b)continue;-1===x.indexOf(b)&&x.push(b)}return x.sort((function(e,o){return e-o}))}_byDayAndMonthDay(e){let o,u,b,w,x=this.by_data.BYDAY,v=0,N=x.length,I=0,M=this,L=this.last.day;function d(){for(w=s.daysInMonth(M.last.month,M.last.year),o=M.normalizeByMonthDayRules(M.last.year,M.last.month,M.by_data.BYMONTHDAY),b=o.length;o[v]<=L&&(!e||o[v]!=L)&&v<b-1;)v++}function m(){L=0,M.increment_month(),v=0,d()}d(),e&&(L-=1);let P=48;for(;!I&&P;){if(P--,u=L+1,u>w){m();continue}let e=o[v++];if(e>=u){L=e;for(let e=0;e<N;e++){let o=this.ruleDayOfWeek(x[e]),u=o[0],b=o[1];if(this.last.day=L,this.last.isNthWeekDay(b,u)){I=1;break}}I||v!==b||m()}else m()}if(P<=0)throw new Error("Malformed values in BYDAY combined with BYMONTHDAY parts");return I}next_month(){let e=1;if(0==this.next_hour())return e;if(this.has_by_data("BYDAY")&&this.has_by_data("BYMONTHDAY"))e=this._byDayAndMonthDay();else if(this.has_by_data("BYDAY")){let o,u=s.daysInMonth(this.last.month,this.last.year),b=0,w=0;if(this.has_by_data("BYSETPOS")){let e=this.last.day;for(let o=1;o<=u;o++)this.last.day=o,this.is_day_in_byday(this.last)&&(w++,o<=e&&b++);this.last.day=e}for(e=0,o=this.last.day+1;o<=u;o++)if(this.last.day=o,this.is_day_in_byday(this.last)&&(!this.has_by_data("BYSETPOS")||this.check_set_position(++b)||this.check_set_position(b-w-1))){e=1;break}o>u&&(this.last.day=1,this.increment_month(),this.is_day_in_byday(this.last)?this.has_by_data("BYSETPOS")&&!this.check_set_position(1)||(e=1):e=0)}else if(this.has_by_data("BYMONTHDAY")){this.by_indices.BYMONTHDAY++,this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length&&(this.by_indices.BYMONTHDAY=0,this.increment_month());let o=s.daysInMonth(this.last.month,this.last.year),u=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];u<0&&(u=o+u+1),u>o?(this.last.day=1,e=this.is_day_in_byday(this.last)):this.last.day=u}else{this.increment_month();let o=s.daysInMonth(this.last.month,this.last.year);this.by_data.BYMONTHDAY[0]>o?e=0:this.last.day=this.by_data.BYMONTHDAY[0]}return e}next_weekday_by_week(){let e=0;if(0==this.next_hour())return e;if(!this.has_by_data("BYDAY"))return 1;for(;;){let o=new s;this.by_indices.BYDAY++,this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length&&(this.by_indices.BYDAY=0,e=1);let u=this.by_data.BYDAY[this.by_indices.BYDAY],b=this.ruleDayOfWeek(u)[1];b-=this.rule.wkst,b<0&&(b+=7),o.year=this.last.year,o.month=this.last.month,o.day=this.last.day;let w=o.startDoyWeek(this.rule.wkst);if(b+w<1&&!e)continue;let x=s.fromDayOfYear(w+b,this.last.year);return this.last.year=x.year,this.last.month=x.month,this.last.day=x.day,e}}next_year(){if(0==this.next_hour())return 0;if(++this.days_index==this.days.length){this.days_index=0;do{this.increment_year(this.rule.interval),this.expand_year_days(this.last.year)}while(0==this.days.length)}return this._nextByYearDay(),1}_nextByYearDay(){let e=this.days[this.days_index],o=this.last.year;e<1&&(e+=1,o+=1);let u=s.fromDayOfYear(e,o);this.last.day=u.day,this.last.month=u.month}ruleDayOfWeek(e,o){let u=e.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);return u?[parseInt(u[1]||0,10),e=B.icalDayToNumericDay(u[2],o)]:[0,0]}next_generic(e,o,u,b,w){let x=e in this.by_data,v=this.rule.freq==o,N=0;if(w&&0==this[w]())return N;if(x){this.by_indices[e]++;let o=this.by_data[e];this.by_indices[e]==o.length&&(this.by_indices[e]=0,N=1),this.last[u]=o[this.by_indices[e]]}else v&&this["increment_"+u](this.rule.interval);return x&&N&&v&&this["increment_"+b](1),N}increment_monthday(e){for(let o=0;o<e;o++){let e=s.daysInMonth(this.last.month,this.last.year);this.last.day++,this.last.day>e&&(this.last.day-=e,this.increment_month())}}increment_month(){if(this.last.day=1,this.has_by_data("BYMONTH"))this.by_indices.BYMONTH++,this.by_indices.BYMONTH==this.by_data.BYMONTH.length&&(this.by_indices.BYMONTH=0,this.increment_year(1)),this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH];else{"MONTHLY"==this.rule.freq?this.last.month+=this.rule.interval:this.last.month++,this.last.month--;let e=A(this.last.month/12);this.last.month%=12,this.last.month++,0!=e&&this.increment_year(e)}}increment_year(e){this.last.year+=e}increment_generic(e,o,u,b){this.last[o]+=e;let w=A(this.last[o]/u);this.last[o]%=u,0!=w&&this["increment_"+b](w)}has_by_data(e){return e in this.rule.parts}expand_year_days(e){let o=new s;this.days=[];let u={},b=["BYDAY","BYWEEKNO","BYMONTHDAY","BYMONTH","BYYEARDAY"];for(let e of b)e in this.rule.parts&&(u[e]=this.rule.parts[e]);if("BYMONTH"in u&&"BYWEEKNO"in u){let b=1,w={};o.year=e,o.isDate=!0;for(let u=0;u<this.by_data.BYMONTH.length;u++){let b=this.by_data.BYMONTH[u];o.month=b,o.day=1;let x=o.weekNumber(this.rule.wkst);o.day=s.daysInMonth(b,e);let v=o.weekNumber(this.rule.wkst);for(u=x;u<v;u++)w[u]=1}for(let e=0;e<this.by_data.BYWEEKNO.length&&b;e++)this.by_data.BYWEEKNO[e]<52?b&=w[e]:b=0;b?delete u.BYMONTH:delete u.BYWEEKNO}let w=Object.keys(u).length;if(0==w){let e=this.dtstart.clone();e.year=this.last.year,this.days.push(e.dayOfYear())}else if(1==w&&"BYMONTH"in u)for(let o of this.by_data.BYMONTH){let u=this.dtstart.clone();u.year=e,u.month=o,u.isDate=!0,this.days.push(u.dayOfYear())}else if(1==w&&"BYMONTHDAY"in u)for(let o of this.by_data.BYMONTHDAY){let u=this.dtstart.clone();o<0&&(o=o+s.daysInMonth(u.month,e)+1);u.day=o,u.year=e,u.isDate=!0,this.days.push(u.dayOfYear())}else if(2==w&&"BYMONTHDAY"in u&&"BYMONTH"in u)for(let u of this.by_data.BYMONTH){let b=s.daysInMonth(u,e);for(let w of this.by_data.BYMONTHDAY)w<0&&(w=w+b+1),o.day=w,o.month=u,o.year=e,o.isDate=!0,this.days.push(o.dayOfYear())}else if(1==w&&"BYWEEKNO"in u);else if(2==w&&"BYWEEKNO"in u&&"BYMONTHDAY"in u);else if(1==w&&"BYDAY"in u)this.days=this.days.concat(this.expand_by_day(e));else if(2==w&&"BYDAY"in u&&"BYMONTH"in u){for(let u of this.by_data.BYMONTH){let b=s.daysInMonth(u,e);o.year=e,o.month=u,o.day=1,o.isDate=!0;let w=o.dayOfWeek(),x=o.dayOfYear()-1;o.day=b;let v=o.dayOfWeek();if(this.has_by_data("BYSETPOS")){let e=[];for(let u=1;u<=b;u++)o.day=u,this.is_day_in_byday(o)&&e.push(u);for(let o=0;o<e.length;o++)(this.check_set_position(o+1)||this.check_set_position(o-e.length))&&this.days.push(x+e[o])}else for(let e of this.by_data.BYDAY){let o,u=this.ruleDayOfWeek(e),N=u[0],I=u[1],M=(I+7-w)%7+1,L=b-(v+7-I)%7;if(0==N)for(let e=M;e<=b;e+=7)this.days.push(x+e);else N>0?(o=M+7*(N-1),o<=b&&this.days.push(x+o)):(o=L+7*(N+1),o>0&&this.days.push(x+o))}}this.days.sort((function(e,o){return e-o}))}else if(2==w&&"BYDAY"in u&&"BYMONTHDAY"in u){let o=this.expand_by_day(e);for(let u of o){let o=s.fromDayOfYear(u,e);this.by_data.BYMONTHDAY.indexOf(o.day)>=0&&this.days.push(u)}}else if(3==w&&"BYDAY"in u&&"BYMONTHDAY"in u&&"BYMONTH"in u){let o=this.expand_by_day(e);for(let u of o){let o=s.fromDayOfYear(u,e);this.by_data.BYMONTH.indexOf(o.month)>=0&&this.by_data.BYMONTHDAY.indexOf(o.day)>=0&&this.days.push(u)}}else if(2==w&&"BYDAY"in u&&"BYWEEKNO"in u){let o=this.expand_by_day(e);for(let u of o){let o=s.fromDayOfYear(u,e).weekNumber(this.rule.wkst);this.by_data.BYWEEKNO.indexOf(o)&&this.days.push(u)}}else 3==w&&"BYDAY"in u&&"BYWEEKNO"in u&&"BYMONTHDAY"in u||(this.days=1==w&&"BYYEARDAY"in u?this.days.concat(this.by_data.BYYEARDAY):[]);return 0}expand_by_day(e){let o=[],u=this.last.clone();u.year=e,u.month=1,u.day=1,u.isDate=!0;let b=u.dayOfWeek();u.month=12,u.day=31,u.isDate=!0;let w=u.dayOfWeek(),x=u.dayOfYear();for(let e of this.by_data.BYDAY){let u=this.ruleDayOfWeek(e),v=u[0],N=u[1];if(0==v)for(let e=(N+7-b)%7+1;e<=x;e+=7)o.push(e);else if(v>0){let e;e=N>=b?N-b+1:N-b+8,o.push(e+7*(v-1))}else{let e;v=-v,e=N<=w?x-w+N:x-w+N-7,o.push(e-7*(v-1))}}return o}is_day_in_byday(e){if(this.by_data.BYDAY)for(let o of this.by_data.BYDAY){let u=this.ruleDayOfWeek(o),b=u[0],w=u[1],x=e.dayOfWeek();if(0==b&&w==x||e.nthWeekDay(w,b)==e.day)return 1}return 0}check_set_position(e){return!!this.has_by_data("BYSETPOS")&&-1!==this.by_data.BYSETPOS.indexOf(e)}sort_byday_rules(e){for(let o=0;o<e.length;o++)for(let u=0;u<o;u++)if(this.ruleDayOfWeek(e[u],this.rule.wkst)[1]>this.ruleDayOfWeek(e[o],this.rule.wkst)[1]){let b=e[o];e[o]=e[u],e[u]=b}}check_contract_restriction(e,o){let u=C._indexMap[e],b=C._expandMap[this.rule.freq][u],w=!1;if(e in this.by_data&&b==C.CONTRACT){let u=this.by_data[e];for(let e of u)if(e==o){w=!0;break}}else w=!0;return w}check_contracting_rules(){let e=this.last.dayOfWeek(),o=this.last.weekNumber(this.rule.wkst),u=this.last.dayOfYear();return this.check_contract_restriction("BYSECOND",this.last.second)&&this.check_contract_restriction("BYMINUTE",this.last.minute)&&this.check_contract_restriction("BYHOUR",this.last.hour)&&this.check_contract_restriction("BYDAY",B.numericDayToIcalDay(e))&&this.check_contract_restriction("BYWEEKNO",o)&&this.check_contract_restriction("BYMONTHDAY",this.last.day)&&this.check_contract_restriction("BYMONTH",this.last.month)&&this.check_contract_restriction("BYYEARDAY",u)}setup_defaults(e,o,u){let b=C._indexMap[e];return C._expandMap[this.rule.freq][b]!=C.CONTRACT&&(e in this.by_data||(this.by_data[e]=[u]),this.rule.freq!=o)?this.by_data[e][0]:u}toJSON(){let e=Object.create(null);return e.initialized=this.initialized,e.rule=this.rule.toJSON(),e.dtstart=this.dtstart.toJSON(),e.by_data=this.by_data,e.days=this.days,e.last=this.last.toJSON(),e.by_indices=this.by_indices,e.occurrence_number=this.occurrence_number,e}}const I=/^(SU|MO|TU|WE|TH|FR|SA)$/,M=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/,L={SU:s.SUNDAY,MO:s.MONDAY,TU:s.TUESDAY,WE:s.WEDNESDAY,TH:s.THURSDAY,FR:s.FRIDAY,SA:s.SATURDAY},P=Object.fromEntries(Object.entries(L).map((e=>e.reverse()))),U=["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"];class B{static fromString(e){let o=this._stringToData(e,!1);return new B(o)}static fromData(e){return new B(e)}static _stringToData(e,o){let u=Object.create(null),b=e.split(";"),w=b.length;for(let e=0;e<w;e++){let w=b[e].split("="),x=w[0].toUpperCase(),v=w[0].toLowerCase(),N=o?v:x,I=w[1];if(x in H){let e=I.split(","),o=0,b=e.length;for(;o<b;o++)e[o]=H[x](e[o]);u[N]=1==e.length?e[0]:e}else x in V?V[x](I,u,o):u[v]=I}return u}static icalDayToNumericDay(e,o){let u=o||s.SUNDAY;return(L[e]-u+7)%7+1}static numericDayToIcalDay(e,o){let u=e+(o||s.SUNDAY)-s.SUNDAY;return u>7&&(u-=7),P[u]}constructor(e){this.wrappedJSObject=this,this.parts={},e&&"object"==typeof e&&this.fromData(e)}parts=null;interval=1;wkst=s.MONDAY;until=null;count=null;freq=null;icalclass="icalrecur";icaltype="recur";iterator(e){return new C({rule:this,dtstart:e})}clone(){return new B(this.toJSON())}isFinite(){return!(!this.count&&!this.until)}isByCount(){return!(!this.count||this.until)}addComponent(e,o){let u=e.toUpperCase();u in this.parts?this.parts[u].push(o):this.parts[u]=[o]}setComponent(e,o){this.parts[e.toUpperCase()]=o.slice()}getComponent(e){let o=e.toUpperCase();return o in this.parts?this.parts[o].slice():[]}getNextOccurrence(e,o){let u,b=this.iterator(e);do{u=b.next()}while(u&&u.compare(o)<=0);return u&&o.zone&&(u.zone=o.zone),u}fromData(e){for(let o in e){let u=o.toUpperCase();u in H?Array.isArray(e[o])?this.parts[u]=e[o]:this.parts[u]=[e[o]]:this[o]=e[o]}this.interval&&"number"!=typeof this.interval&&V.INTERVAL(this.interval,this),this.wkst&&"number"!=typeof this.wkst&&(this.wkst=B.icalDayToNumericDay(this.wkst)),!this.until||this.until instanceof s||(this.until=s.fromString(this.until))}toJSON(){let e=Object.create(null);e.freq=this.freq,this.count&&(e.count=this.count),this.interval>1&&(e.interval=this.interval);for(let[o,u]of Object.entries(this.parts))Array.isArray(u)&&1==u.length?e[o.toLowerCase()]=u[0]:e[o.toLowerCase()]=D(u);return this.until&&(e.until=this.until.toString()),"wkst"in this&&this.wkst!==s.DEFAULT_WEEK_START&&(e.wkst=B.numericDayToIcalDay(this.wkst)),e}toString(){let e="FREQ="+this.freq;this.count&&(e+=";COUNT="+this.count),this.interval>1&&(e+=";INTERVAL="+this.interval);for(let[o,u]of Object.entries(this.parts))e+=";"+o+"="+u;return this.until&&(e+=";UNTIL="+this.until.toICALString()),"wkst"in this&&this.wkst!==s.DEFAULT_WEEK_START&&(e+=";WKST="+B.numericDayToIcalDay(this.wkst)),e}}function z(e,o,u,b){let w=b;if("+"===b[0]&&(w=b.slice(1)),w=p(w),void 0!==o&&b<o)throw new Error(e+': invalid value "'+b+'" must be > '+o);if(void 0!==u&&b>u)throw new Error(e+': invalid value "'+b+'" must be < '+o);return w}const V={FREQ:function(e,o,u){if(-1===U.indexOf(e))throw new Error('invalid frequency "'+e+'" expected: "'+U.join(", ")+'"');o.freq=e},COUNT:function(e,o,u){o.count=p(e)},INTERVAL:function(e,o,u){o.interval=p(e),o.interval<1&&(o.interval=1)},UNTIL:function(e,o,u){e.length>10?o.until=Yt.icalendar.value["date-time"].fromICAL(e):o.until=Yt.icalendar.value.date.fromICAL(e),u||(o.until=s.fromString(o.until))},WKST:function(e,o,u){if(!I.test(e))throw new Error('invalid WKST value "'+e+'"');o.wkst=B.icalDayToNumericDay(e)}},H={BYSECOND:z.bind(void 0,"BYSECOND",0,60),BYMINUTE:z.bind(void 0,"BYMINUTE",0,59),BYHOUR:z.bind(void 0,"BYHOUR",0,23),BYDAY:function(e){if(M.test(e))return e;throw new Error('invalid BYDAY value "'+e+'"')},BYMONTHDAY:z.bind(void 0,"BYMONTHDAY",-31,31),BYYEARDAY:z.bind(void 0,"BYYEARDAY",-366,366),BYWEEKNO:z.bind(void 0,"BYWEEKNO",-53,53),BYMONTH:z.bind(void 0,"BYMONTH",1,12),BYSETPOS:z.bind(void 0,"BYSETPOS",-366,366)};class k{static fromString(e,o){let u=e.split("/");if(2!==u.length)throw new Error('Invalid string value: "'+e+'" must contain a "/" char.');let b={start:s.fromDateTimeString(u[0],o)},w=u[1];return r.isValueString(w)?b.duration=r.fromString(w):b.end=s.fromDateTimeString(w,o),new k(b)}static fromData(e){return new k(e)}static fromJSON(e,o,u){function n(e,o){return u?s.fromString(e,o):s.fromDateTimeString(e,o)}return r.isValueString(e[1])?k.fromData({start:n(e[0],o),duration:r.fromString(e[1])}):k.fromData({start:n(e[0],o),end:n(e[1],o)})}constructor(e){if(this.wrappedJSObject=this,e&&"start"in e){if(e.start&&!(e.start instanceof s))throw new TypeError(".start must be an instance of ICAL.Time");this.start=e.start}if(e&&e.end&&e.duration)throw new Error("cannot accept both end and duration");if(e&&"end"in e){if(e.end&&!(e.end instanceof s))throw new TypeError(".end must be an instance of ICAL.Time");this.end=e.end}if(e&&"duration"in e){if(e.duration&&!(e.duration instanceof r))throw new TypeError(".duration must be an instance of ICAL.Duration");this.duration=e.duration}}start=null;end=null;duration=null;icalclass="icalperiod";icaltype="period";clone(){return k.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null})}getDuration(){return this.duration?this.duration:this.end.subtractDate(this.start)}getEnd(){if(this.end)return this.end;{let e=this.start.clone();return e.addDuration(this.duration),e}}toString(){return this.start+"/"+(this.end||this.duration)}toJSON(){return[this.start.toString(),(this.end||this.duration).toString()]}toICALString(){return this.start.toICALString()+"/"+(this.end||this.duration).toICALString()}}const R=/\\\\|\\,|\\[Nn]/g,W=/\\|,|\n/g;function j(e,o){return{matches:/.*/,fromICAL:function(o,u){return function(e,o,u){if(-1===e.indexOf("\\"))return e;u&&(o=new RegExp(o.source+"|\\\\"+u,o.flags));return e.replace(o,X)}(o,e,u)},toICAL:function(e,u){let b=o;return u&&(b=new RegExp(b.source+"|"+u,b.flags)),e.replace(b,(function(e){switch(e){case"\\":return"\\\\";case";":return"\\;";case",":return"\\,";case"\n":return"\\n";default:return e}}))}}}const F={defaultType:"text"},K={defaultType:"text",multiValue:","},q={defaultType:"text",structuredValue:";"},J={defaultType:"integer"},Z={defaultType:"date-time",allowedTypes:["date-time","date"]},G={defaultType:"date-time"},Q={defaultType:"uri"},$={defaultType:"utc-offset"},tt={defaultType:"recur"},et={defaultType:"date-and-or-time",allowedTypes:["date-time","date","text"]};function X(e){switch(e){case"\\\\":return"\\";case"\\;":return";";case"\\,":return",";case"\\n":case"\\N":return"\n";default:return e}}let it={categories:K,url:Q,version:F,uid:F},rt={boolean:{values:["TRUE","FALSE"],fromICAL:function(e){return"TRUE"===e},toICAL:function(e){return e?"TRUE":"FALSE"}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function(e){let o=parseFloat(e);return f(o)?0:o},toICAL:function(e){return String(e)}},integer:{fromICAL:function(e){let o=parseInt(e);return f(o)?0:o},toICAL:function(e){return String(e)}},"utc-offset":{toICAL:function(e){return e.length<7?e.slice(0,3)+e.slice(4,6):e.slice(0,3)+e.slice(4,6)+e.slice(7,9)},fromICAL:function(e){return e.length<6?e.slice(0,3)+":"+e.slice(3,5):e.slice(0,3)+":"+e.slice(3,5)+":"+e.slice(5,7)},decorate:function(e){return S.fromString(e)},undecorate:function(e){return e.toString()}}};const nt=O(rt,{text:j(/\\\\|\\;|\\,|\\[Nn]/g,/\\|;|,|\n/g),uri:{},binary:{decorate:function(e){return t.fromString(e)},undecorate:function(e){return e.toString()}},"cal-address":{},date:{decorate:function(e,o){return mt.strict?s.fromDateString(e,o):s.fromString(e,o)},undecorate:function(e){return e.toString()},fromICAL:function(e){return!mt.strict&&e.length>=15?nt["date-time"].fromICAL(e):e.slice(0,4)+"-"+e.slice(4,6)+"-"+e.slice(6,8)},toICAL:function(e){let o=e.length;return 10==o?e.slice(0,4)+e.slice(5,7)+e.slice(8,10):o>=19?nt["date-time"].toICAL(e):e}},"date-time":{fromICAL:function(e){if(mt.strict||8!=e.length){let o=e.slice(0,4)+"-"+e.slice(4,6)+"-"+e.slice(6,8)+"T"+e.slice(9,11)+":"+e.slice(11,13)+":"+e.slice(13,15);return e[15]&&"Z"===e[15]&&(o+="Z"),o}return nt.date.fromICAL(e)},toICAL:function(e){let o=e.length;if(10!=o||mt.strict){if(o>=19){let o=e.slice(0,4)+e.slice(5,7)+e.slice(8,13)+e.slice(14,16)+e.slice(17,19);return e[19]&&"Z"===e[19]&&(o+="Z"),o}return e}return nt.date.toICAL(e)},decorate:function(e,o){return mt.strict?s.fromDateTimeString(e,o):s.fromString(e,o)},undecorate:function(e){return e.toString()}},duration:{decorate:function(e){return r.fromString(e)},undecorate:function(e){return e.toString()}},period:{fromICAL:function(e){let o=e.split("/");return o[0]=nt["date-time"].fromICAL(o[0]),r.isValueString(o[1])||(o[1]=nt["date-time"].fromICAL(o[1])),o},toICAL:function(e){return e=e.slice(),mt.strict||10!=e[0].length?e[0]=nt["date-time"].toICAL(e[0]):e[0]=nt.date.toICAL(e[0]),r.isValueString(e[1])||(mt.strict||10!=e[1].length?e[1]=nt["date-time"].toICAL(e[1]):e[1]=nt.date.toICAL(e[1])),e.join("/")},decorate:function(e,o){return k.fromJSON(e,o,!mt.strict)},undecorate:function(e){return e.toJSON()}},recur:{fromICAL:function(e){return B._stringToData(e,!0)},toICAL:function(e){let o="";for(let[u,b]of Object.entries(e))"until"==u?b=b.length>10?nt["date-time"].toICAL(b):nt.date.toICAL(b):"wkst"==u?"number"==typeof b&&(b=B.numericDayToIcalDay(b)):Array.isArray(b)&&(b=b.join(",")),o+=u.toUpperCase()+"="+b+";";return o.slice(0,Math.max(0,o.length-1))},decorate:function(e){return B.fromData(e)},undecorate:function(e){return e.toJSON()}},time:{fromICAL:function(e){if(e.length<6)return e;let o=e.slice(0,2)+":"+e.slice(2,4)+":"+e.slice(4,6);return"Z"===e[6]&&(o+="Z"),o},toICAL:function(e){if(e.length<8)return e;let o=e.slice(0,2)+e.slice(3,5)+e.slice(6,8);return"Z"===e[8]&&(o+="Z"),o}}});let st=O(it,{action:F,attach:{defaultType:"uri"},attendee:{defaultType:"cal-address"},calscale:F,class:F,comment:F,completed:G,contact:F,created:G,description:F,dtend:Z,dtstamp:G,dtstart:Z,due:Z,duration:{defaultType:"duration"},exdate:{defaultType:"date-time",allowedTypes:["date-time","date"],multiValue:","},exrule:tt,freebusy:{defaultType:"period",multiValue:","},geo:{defaultType:"float",structuredValue:";"},"last-modified":G,location:F,method:F,organizer:{defaultType:"cal-address"},"percent-complete":J,priority:J,prodid:F,"related-to":F,repeat:J,rdate:{defaultType:"date-time",allowedTypes:["date-time","date","period"],multiValue:",",detectType:function(e){return-1!==e.indexOf("/")?"period":-1===e.indexOf("T")?"date":"date-time"}},"recurrence-id":Z,resources:K,"request-status":q,rrule:tt,sequence:J,status:F,summary:F,transp:F,trigger:{defaultType:"duration",allowedTypes:["duration","date-time"]},tzoffsetfrom:$,tzoffsetto:$,tzurl:Q,tzid:F,tzname:F});const at=O(rt,{text:j(R,W),uri:j(R,W),date:{decorate:function(e){return E.fromDateAndOrTimeString(e,"date")},undecorate:function(e){return e.toString()},fromICAL:function(e){return 8==e.length?nt.date.fromICAL(e):"-"==e[0]&&6==e.length?e.slice(0,4)+"-"+e.slice(4):e},toICAL:function(e){return 10==e.length?nt.date.toICAL(e):"-"==e[0]&&7==e.length?e.slice(0,4)+e.slice(5):e}},time:{decorate:function(e){return E.fromDateAndOrTimeString("T"+e,"time")},undecorate:function(e){return e.toString()},fromICAL:function(e){let o=at.time._splitZone(e,!0),u=o[0],b=o[1];return 6==b.length?b=b.slice(0,2)+":"+b.slice(2,4)+":"+b.slice(4,6):4==b.length&&"-"!=b[0]?b=b.slice(0,2)+":"+b.slice(2,4):5==b.length&&(b=b.slice(0,3)+":"+b.slice(3,5)),5!=u.length||"-"!=u[0]&&"+"!=u[0]||(u=u.slice(0,3)+":"+u.slice(3)),b+u},toICAL:function(e){let o=at.time._splitZone(e),u=o[0],b=o[1];return 8==b.length?b=b.slice(0,2)+b.slice(3,5)+b.slice(6,8):5==b.length&&"-"!=b[0]?b=b.slice(0,2)+b.slice(3,5):6==b.length&&(b=b.slice(0,3)+b.slice(4,6)),6!=u.length||"-"!=u[0]&&"+"!=u[0]||(u=u.slice(0,3)+u.slice(4)),b+u},_splitZone:function(e,o){let u,b,w=e.length-1,x=e.length-(o?5:6),v=e[x];return"Z"==e[w]?(u=e[w],b=e.slice(0,Math.max(0,w))):e.length>6&&("-"==v||"+"==v)?(u=e.slice(x),b=e.slice(0,Math.max(0,x))):(u="",b=e),[u,b]}},"date-time":{decorate:function(e){return E.fromDateAndOrTimeString(e,"date-time")},undecorate:function(e){return e.toString()},fromICAL:function(e){return at["date-and-or-time"].fromICAL(e)},toICAL:function(e){return at["date-and-or-time"].toICAL(e)}},"date-and-or-time":{decorate:function(e){return E.fromDateAndOrTimeString(e,"date-and-or-time")},undecorate:function(e){return e.toString()},fromICAL:function(e){let o=e.split("T");return(o[0]?at.date.fromICAL(o[0]):"")+(o[1]?"T"+at.time.fromICAL(o[1]):"")},toICAL:function(e){let o=e.split("T");return at.date.toICAL(o[0])+(o[1]?"T"+at.time.toICAL(o[1]):"")}},timestamp:nt["date-time"],"language-tag":{matches:/^[a-zA-Z0-9-]+$/},"phone-number":{fromICAL:function(e){return Array.from(e).filter((function(e){return"\\"===e?void 0:e})).join("")},toICAL:function(e){return Array.from(e).map((function(e){return","===e||";"===e?"\\"+e:e})).join("")}}});let ot=O(it,{adr:{defaultType:"text",structuredValue:";",multiValue:","},anniversary:et,bday:et,caladruri:Q,caluri:Q,clientpidmap:q,email:F,fburl:Q,fn:F,gender:q,geo:Q,impp:Q,key:Q,kind:F,lang:{defaultType:"language-tag"},logo:Q,member:Q,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:K,note:F,org:{defaultType:"text",structuredValue:";"},photo:Q,related:Q,rev:{defaultType:"timestamp"},role:F,sound:Q,source:Q,tel:{defaultType:"uri",allowedTypes:["uri","text"]},title:F,tz:{defaultType:"text",allowedTypes:["text","utc-offset","uri"]},xml:F}),lt=O(rt,{binary:nt.binary,date:at.date,"date-time":at["date-time"],"phone-number":at["phone-number"],uri:nt.uri,text:nt.text,time:nt.time,vcard:nt.text,"utc-offset":{toICAL:function(e){return e.slice(0,7)},fromICAL:function(e){return e.slice(0,7)},decorate:function(e){return S.fromString(e)},undecorate:function(e){return e.toString()}}}),ht=O(it,{fn:F,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:K,photo:{defaultType:"binary",allowedTypes:["binary","uri"]},bday:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(e){return-1===e.indexOf("T")?"date":"date-time"}},adr:{defaultType:"text",structuredValue:";",multiValue:","},label:F,tel:{defaultType:"phone-number"},email:F,mailer:F,tz:{defaultType:"utc-offset",allowedTypes:["utc-offset","text"]},geo:{defaultType:"float",structuredValue:";"},title:F,role:F,logo:{defaultType:"binary",allowedTypes:["binary","uri"]},agent:{defaultType:"vcard",allowedTypes:["vcard","text","uri"]},org:q,note:K,prodid:F,rev:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(e){return-1===e.indexOf("T")?"date":"date-time"}},"sort-string":F,sound:{defaultType:"binary",allowedTypes:["binary","uri"]},class:F,key:{defaultType:"binary",allowedTypes:["binary","text"]}}),ut={value:nt,param:{cutype:{values:["INDIVIDUAL","GROUP","RESOURCE","ROOM","UNKNOWN"],allowXName:!0,allowIanaToken:!0},"delegated-from":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},"delegated-to":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},encoding:{values:["8BIT","BASE64"]},fbtype:{values:["FREE","BUSY","BUSY-UNAVAILABLE","BUSY-TENTATIVE"],allowXName:!0,allowIanaToken:!0},member:{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},partstat:{values:["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE","DELEGATED","COMPLETED","IN-PROCESS"],allowXName:!0,allowIanaToken:!0},range:{values:["THISANDFUTURE"]},related:{values:["START","END"]},reltype:{values:["PARENT","CHILD","SIBLING"],allowXName:!0,allowIanaToken:!0},role:{values:["REQ-PARTICIPANT","CHAIR","OPT-PARTICIPANT","NON-PARTICIPANT"],allowXName:!0,allowIanaToken:!0},rsvp:{values:["TRUE","FALSE"]},"sent-by":{valueType:"cal-address"},tzid:{matches:/^\//},value:{values:["binary","boolean","cal-address","date","date-time","duration","float","integer","period","recur","text","time","uri","utc-offset"],allowXName:!0,allowIanaToken:!0}},property:st,propertyGroups:!1},ct={value:at,param:{type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","time","date-time","date-and-or-time","timestamp","boolean","integer","float","utc-offset","language-tag"],allowXName:!0,allowIanaToken:!0}},property:ot,propertyGroups:!0},dt={value:lt,param:{type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","date-time","phone-number","time","boolean","integer","float","utc-offset","vcard","binary"],allowXName:!0,allowIanaToken:!0}},property:ht,propertyGroups:!0};const mt={strict:!0,defaultSet:ut,defaultType:"unknown",components:{vcard:ct,vcard3:dt,vevent:ut,vtodo:ut,vjournal:ut,valarm:ut,vtimezone:ut,daylight:ut,standard:ut},icalendar:ut,vcard:ct,vcard3:dt,getDesignSet:function(e){return e&&e in mt.components?mt.components[e]:mt.defaultSet}};var Yt=mt;const Tt="\r\n",At="unknown",Ot={'"':"^'","\n":"^n","^":"^^"};function ft(e){"string"==typeof e[0]&&(e=[e]);let o=0,u=e.length,b="";for(;o<u;o++)b+=ft.component(e[o])+Tt;return b}ft.component=function(e,o){let u=e[0].toUpperCase(),b="BEGIN:"+u+Tt,w=e[1],x=0,v=w.length,N=e[0];for("vcard"===N&&e[1].length>0&&("version"!==e[1][0][0]||"4.0"!==e[1][0][3])&&(N="vcard3"),o=o||Yt.getDesignSet(N);x<v;x++)b+=ft.property(w[x],o)+Tt;let I=e[2]||[],M=0,L=I.length;for(;M<L;M++)b+=ft.component(I[M],o)+Tt;return b+="END:"+u,b},ft.property=function(e,o,u){let b=e[0].toUpperCase(),w=e[0],x=e[1];o||(o=Yt.defaultSet);let v,N=x.group;v=o.propertyGroups&&N?N.toUpperCase()+"."+b:b;for(let[e,u]of Object.entries(x)){if(o.propertyGroups&&"group"==e)continue;let b=o.param[e],w=b&&b.multiValue;w&&Array.isArray(u)?(u=u.map((function(e){return e=ft._rfc6868Unescape(e),ft.paramPropertyValue(e,b.multiValueSeparateDQuote)})),u=ft.multiValue(u,w,"unknown",null,o)):(u=ft._rfc6868Unescape(u),u=ft.paramPropertyValue(u)),v+=";"+e.toUpperCase()+"="+u}if(3===e.length)return v+":";let I,M=e[2],L=!1,P=!1,U=!1;return w in o.property?(I=o.property[w],"multiValue"in I&&(L=I.multiValue),"structuredValue"in I&&Array.isArray(e[3])&&(P=I.structuredValue),"defaultType"in I?M===I.defaultType&&(U=!0):M===At&&(U=!0)):M===At&&(U=!0),U||(v+=";VALUE="+M.toUpperCase()),v+=":",v+=L&&P?ft.multiValue(e[3],P,M,L,o,P):L?ft.multiValue(e.slice(3),L,M,null,o,!1):P?ft.multiValue(e[3],P,M,null,o,P):ft.value(e[3],M,o,!1),u?v:T(v)},ft.paramPropertyValue=function(e,o){return o||-1!==_(e,",")||-1!==_(e,":")||-1!==_(e,";")?'"'+e+'"':e},ft.multiValue=function(e,o,u,b,w,x){let v="",N=e.length,I=0;for(;I<N;I++)b&&Array.isArray(e[I])?v+=ft.multiValue(e[I],b,u,null,w,x):v+=ft.value(e[I],u,w,x),I!==N-1&&(v+=o);return v},ft.value=function(e,o,u,b){return o in u.value&&"toICAL"in u.value[o]?u.value[o].toICAL(e,b):e},ft._rfc6868Unescape=function(e){return e.replace(/[\n^"]/g,(function(e){return Ot[e]}))};class pt{static fromString(e,o){return new pt(l.property(e,o))}constructor(e,o){this._parent=o||null,"string"==typeof e?(this.jCal=[e,{},Yt.defaultType],this.jCal[2]=this.getDefaultType()):this.jCal=e,this._updateType()}get type(){return this.jCal[2]}get name(){return this.jCal[0]}get parent(){return this._parent}set parent(e){let o=!this._parent||e&&e._designSet!=this._parent._designSet;this._parent=e,this.type==Yt.defaultType&&o&&(this.jCal[2]=this.getDefaultType(),this._updateType())}get _designSet(){return this.parent?this.parent._designSet:Yt.defaultSet}_updateType(){let e=this._designSet;this.type in e.value&&("decorate"in e.value[this.type]?this.isDecorated=!0:this.isDecorated=!1,this.name in e.property&&(this.isMultiValue="multiValue"in e.property[this.name],this.isStructuredValue="structuredValue"in e.property[this.name]))}_hydrateValue(e){return this._values&&this._values[e]?this._values[e]:this.jCal.length<=3+e?null:this.isDecorated?(this._values||(this._values=[]),this._values[e]=this._decorate(this.jCal[3+e])):this.jCal[3+e]}_decorate(e){return this._designSet.value[this.type].decorate(e,this)}_undecorate(e){return this._designSet.value[this.type].undecorate(e,this)}_setDecoratedValue(e,o){this._values||(this._values=[]),"object"==typeof e&&"icaltype"in e?(this.jCal[3+o]=this._undecorate(e),this._values[o]=e):(this.jCal[3+o]=e,this._values[o]=this._decorate(e))}getParameter(e){return e in this.jCal[1]?this.jCal[1][e]:void 0}getFirstParameter(e){let o=this.getParameter(e);return Array.isArray(o)?o[0]:o}setParameter(e,o){let u=e.toLowerCase();"string"==typeof o&&u in this._designSet.param&&"multiValue"in this._designSet.param[u]&&(o=[o]),this.jCal[1][e]=o}removeParameter(e){delete this.jCal[1][e]}getDefaultType(){let e=this.jCal[0],o=this._designSet;if(e in o.property){let u=o.property[e];if("defaultType"in u)return u.defaultType}return Yt.defaultType}resetType(e){this.removeAllValues(),this.jCal[2]=e,this._updateType()}getFirstValue(){return this._hydrateValue(0)}getValues(){let e=this.jCal.length-3;if(e<1)return[];let o=0,u=[];for(;o<e;o++)u[o]=this._hydrateValue(o);return u}removeAllValues(){this._values&&(this._values.length=0),this.jCal.length=3}setValues(e){if(!this.isMultiValue)throw new Error(this.name+": does not not support mulitValue.\noverride isMultiValue");let o=e.length,u=0;if(this.removeAllValues(),o>0&&"object"==typeof e[0]&&"icaltype"in e[0]&&this.resetType(e[0].icaltype),this.isDecorated)for(;u<o;u++)this._setDecoratedValue(e[u],u);else for(;u<o;u++)this.jCal[3+u]=e[u]}setValue(e){this.removeAllValues(),"object"==typeof e&&"icaltype"in e&&this.resetType(e.icaltype),this.isDecorated?this._setDecoratedValue(e,0):this.jCal[3]=e}toJSON(){return this.jCal}toICALString(){return ft.property(this.jCal,this._designSet,!0)}}class yt{static fromString(e){return new yt(l.component(e))}constructor(e,o){"string"==typeof e&&(e=[e,[],[]]),this.jCal=e,this.parent=o||null,this.parent||"vcalendar"!==this.name||(this._timezoneCache=new Map)}_hydratedPropertyCount=0;_hydratedComponentCount=0;_timezoneCache=null;get name(){return this.jCal[0]}get _designSet(){return this.parent&&this.parent._designSet||Yt.getDesignSet(this.name)}_hydrateComponent(e){if(this._components||(this._components=[],this._hydratedComponentCount=0),this._components[e])return this._components[e];let o=new yt(this.jCal[2][e],this);return this._hydratedComponentCount++,this._components[e]=o}_hydrateProperty(e){if(this._properties||(this._properties=[],this._hydratedPropertyCount=0),this._properties[e])return this._properties[e];let o=new pt(this.jCal[1][e],this);return this._hydratedPropertyCount++,this._properties[e]=o}getFirstSubcomponent(e){if(e){let o=0,u=this.jCal[2],b=u.length;for(;o<b;o++)if(u[o][0]===e)return this._hydrateComponent(o)}else if(this.jCal[2].length)return this._hydrateComponent(0);return null}getAllSubcomponents(e){let o=this.jCal[2].length,u=0;if(e){let b=this.jCal[2],w=[];for(;u<o;u++)e===b[u][0]&&w.push(this._hydrateComponent(u));return w}if(!this._components||this._hydratedComponentCount!==o)for(;u<o;u++)this._hydrateComponent(u);return this._components||[]}hasProperty(e){let o=this.jCal[1],u=o.length,b=0;for(;b<u;b++)if(o[b][0]===e)return!0;return!1}getFirstProperty(e){if(e){let o=0,u=this.jCal[1],b=u.length;for(;o<b;o++)if(u[o][0]===e)return this._hydrateProperty(o)}else if(this.jCal[1].length)return this._hydrateProperty(0);return null}getFirstPropertyValue(e){let o=this.getFirstProperty(e);return o?o.getFirstValue():null}getAllProperties(e){let o=this.jCal[1].length,u=0;if(e){let b=this.jCal[1],w=[];for(;u<o;u++)e===b[u][0]&&w.push(this._hydrateProperty(u));return w}if(!this._properties||this._hydratedPropertyCount!==o)for(;u<o;u++)this._hydrateProperty(u);return this._properties||[]}_removeObjectByIndex(e,o,u){if((o=o||[])[u]){let e=o[u];"parent"in e&&(e.parent=null)}o.splice(u,1),this.jCal[e].splice(u,1)}_removeObject(e,o,u){let b=0,w=this.jCal[e],x=w.length,v=this[o];if("string"==typeof u){for(;b<x;b++)if(w[b][0]===u)return this._removeObjectByIndex(e,v,b),!0}else if(v)for(;b<x;b++)if(v[b]&&v[b]===u)return this._removeObjectByIndex(e,v,b),!0;return!1}_removeAllObjects(e,o,u){let b=this[o],w=this.jCal[e],x=w.length-1;for(;x>=0;x--)u&&w[x][0]!==u||this._removeObjectByIndex(e,b,x)}addSubcomponent(e){this._components||(this._components=[],this._hydratedComponentCount=0),e.parent&&e.parent.removeSubcomponent(e);let o=this.jCal[2].push(e.jCal);return this._components[o-1]=e,this._hydratedComponentCount++,e.parent=this,e}removeSubcomponent(e){let o=this._removeObject(2,"_components",e);return o&&this._hydratedComponentCount--,o}removeAllSubcomponents(e){let o=this._removeAllObjects(2,"_components",e);return this._hydratedComponentCount=0,o}addProperty(e){if(!(e instanceof pt))throw new TypeError("must be instance of ICAL.Property");this._properties||(this._properties=[],this._hydratedPropertyCount=0),e.parent&&e.parent.removeProperty(e);let o=this.jCal[1].push(e.jCal);return this._properties[o-1]=e,this._hydratedPropertyCount++,e.parent=this,e}addPropertyWithValue(e,o){let u=new pt(e);return u.setValue(o),this.addProperty(u),u}updatePropertyWithValue(e,o){let u=this.getFirstProperty(e);return u?u.setValue(o):u=this.addPropertyWithValue(e,o),u}removeProperty(e){let o=this._removeObject(1,"_properties",e);return o&&this._hydratedPropertyCount--,o}removeAllProperties(e){let o=this._removeAllObjects(1,"_properties",e);return this._hydratedPropertyCount=0,o}toJSON(){return this.jCal}toString(){return ft.component(this.jCal,this._designSet)}getTimeZoneByID(e){if(this.parent)return this.parent.getTimeZoneByID(e);if(!this._timezoneCache)return null;if(this._timezoneCache.has(e))return this._timezoneCache.get(e);const o=this.getAllSubcomponents("vtimezone");for(const u of o)if(u.getFirstProperty("tzid").getFirstValue()===e){const o=new c({component:u,tzid:e});return this._timezoneCache.set(e,o),o}return null}}class _t{constructor(e){this.ruleDates=[],this.exDates=[],this.fromData(e)}complete=!1;ruleIterators=null;ruleDates=null;exDates=null;ruleDateInc=0;exDateInc=0;exDate=null;ruleDate=null;dtstart=null;last=null;fromData(e){let o=y(e.dtstart,s);if(!o)throw new Error(".dtstart (ICAL.Time) must be given");if(this.dtstart=o,e.component)this._init(e.component);else{if(this.last=y(e.last,s)||o.clone(),!e.ruleIterators)throw new Error(".ruleIterators or .component must be given");this.ruleIterators=e.ruleIterators.map((function(e){return y(e,C)})),this.ruleDateInc=e.ruleDateInc,this.exDateInc=e.exDateInc,e.ruleDates&&(this.ruleDates=e.ruleDates.map((e=>y(e,s))),this.ruleDate=this.ruleDates[this.ruleDateInc]),e.exDates&&(this.exDates=e.exDates.map((e=>y(e,s))),this.exDate=this.exDates[this.exDateInc]),void 0!==e.complete&&(this.complete=e.complete)}}next(){let e,o,u,b=0;for(;;){if(b++>500)throw new Error("max tries have occurred, rule may be impossible to fulfill.");if(o=this.ruleDate,e=this._nextRecurrenceIter(this.last),!o&&!e){this.complete=!0;break}if((!o||e&&o.compare(e.last)>0)&&(o=e.last.clone(),e.next()),this.ruleDate===o&&this._nextRuleDay(),this.last=o,!this.exDate||(u=this.exDate.compare(this.last),u<0&&this._nextExDay(),0!==u))return this.last;this._nextExDay()}}toJSON(){function t(e){return e.toJSON()}let e=Object.create(null);return e.ruleIterators=this.ruleIterators.map(t),this.ruleDates&&(e.ruleDates=this.ruleDates.map(t)),this.exDates&&(e.exDates=this.exDates.map(t)),e.ruleDateInc=this.ruleDateInc,e.exDateInc=this.exDateInc,e.last=this.last.toJSON(),e.dtstart=this.dtstart.toJSON(),e.complete=this.complete,e}_extractDates(e,o){let u=[],b=e.getAllProperties(o);for(let e=0,o=b.length;e<o;e++)for(let o of b[e].getValues()){let e=g(u,o,((e,o)=>e.compare(o)));u.splice(e,0,o)}return u}_init(e){if(this.ruleIterators=[],this.last=this.dtstart.clone(),!e.hasProperty("rdate")&&!e.hasProperty("rrule")&&!e.hasProperty("recurrence-id"))return this.ruleDate=this.last.clone(),void(this.complete=!0);if(e.hasProperty("rdate")&&(this.ruleDates=this._extractDates(e,"rdate"),this.ruleDates[0]&&this.ruleDates[0].compare(this.dtstart)<0?(this.ruleDateInc=0,this.last=this.ruleDates[0].clone()):this.ruleDateInc=g(this.ruleDates,this.last,((e,o)=>e.compare(o))),this.ruleDate=this.ruleDates[this.ruleDateInc]),e.hasProperty("rrule")){let o,u,b=e.getAllProperties("rrule"),w=0,x=b.length;for(;w<x;w++)o=b[w].getFirstValue(),u=o.iterator(this.dtstart),this.ruleIterators.push(u),u.next()}e.hasProperty("exdate")&&(this.exDates=this._extractDates(e,"exdate"),this.exDateInc=g(this.exDates,this.last,((e,o)=>e.compare(o))),this.exDate=this.exDates[this.exDateInc])}_nextExDay(){this.exDate=this.exDates[++this.exDateInc]}_nextRuleDay(){this.ruleDate=this.ruleDates[++this.ruleDateInc]}_nextRecurrenceIter(){let e=this.ruleIterators;if(0===e.length)return null;let o,u,b,w=e.length,x=0;for(;x<w;x++)o=e[x],u=o.last,o.completed?(w--,0!==x&&x--,e.splice(x,1)):(!b||b.last.compare(u)>0)&&(b=o);return b}}class gt{constructor(e,o){e instanceof yt||(o=e,e=null),this.component=e||new yt("vevent"),this._rangeExceptionCache=Object.create(null),this.exceptions=Object.create(null),this.rangeExceptions=[],o&&o.strictExceptions&&(this.strictExceptions=o.strictExceptions),o&&o.exceptions?o.exceptions.forEach(this.relateException,this):this.component.parent&&!this.isRecurrenceException()&&this.component.parent.getAllSubcomponents("vevent").forEach((function(e){e.hasProperty("recurrence-id")&&this.relateException(e)}),this)}static THISANDFUTURE="THISANDFUTURE";exceptions=null;strictExceptions=!1;relateException(e){if(this.isRecurrenceException())throw new Error("cannot relate exception to exceptions");if(e instanceof yt&&(e=new gt(e)),this.strictExceptions&&e.uid!==this.uid)throw new Error("attempted to relate unrelated exception");let o=e.recurrenceId.toString();if(this.exceptions[o]=e,e.modifiesFuture()){let u=[e.recurrenceId.toUnixTime(),o],b=g(this.rangeExceptions,u,Dt);this.rangeExceptions.splice(b,0,u)}}modifiesFuture(){return!!this.component.hasProperty("recurrence-id")&&this.component.getFirstProperty("recurrence-id").getParameter("range")===gt.THISANDFUTURE}findRangeException(e){if(!this.rangeExceptions.length)return null;let o=e.toUnixTime(),u=g(this.rangeExceptions,[o],Dt);if(u-=1,u<0)return null;let b=this.rangeExceptions[u];return o<b[0]?null:b[1]}getOccurrenceDetails(e){let o,u=e.toString(),b=e.convertToZone(c.utcTimezone).toString(),w={recurrenceId:e};if(u in this.exceptions)o=w.item=this.exceptions[u],w.startDate=o.startDate,w.endDate=o.endDate,w.item=o;else if(b in this.exceptions)o=this.exceptions[b],w.startDate=o.startDate,w.endDate=o.endDate,w.item=o;else{let o,u=this.findRangeException(e);if(u){let b=this.exceptions[u];w.item=b;let x=this._rangeExceptionCache[u];if(!x){let e=b.recurrenceId.clone(),o=b.startDate.clone();e.zone=o.zone,x=o.subtractDate(e),this._rangeExceptionCache[u]=x}let v=e.clone();v.zone=b.startDate.zone,v.addDuration(x),o=v.clone(),o.addDuration(b.duration),w.startDate=v,w.endDate=o}else o=e.clone(),o.addDuration(this.duration),w.endDate=o,w.startDate=e,w.item=this}return w}iterator(e){return new _t({component:this.component,dtstart:e||this.startDate})}isRecurring(){let e=this.component;return e.hasProperty("rrule")||e.hasProperty("rdate")}isRecurrenceException(){return this.component.hasProperty("recurrence-id")}getRecurrenceTypes(){let e=this.component.getAllProperties("rrule"),o=0,u=e.length,b=Object.create(null);for(;o<u;o++)b[e[o].getFirstValue().freq]=!0;return b}get uid(){return this._firstProp("uid")}set uid(e){this._setProp("uid",e)}get startDate(){return this._firstProp("dtstart")}set startDate(e){this._setTime("dtstart",e)}get endDate(){let e=this._firstProp("dtend");if(!e){let o=this._firstProp("duration");e=this.startDate.clone(),o?e.addDuration(o):e.isDate&&(e.day+=1)}return e}set endDate(e){this.component.hasProperty("duration")&&this.component.removeProperty("duration"),this._setTime("dtend",e)}get duration(){let e=this._firstProp("duration");return e||this.endDate.subtractDateTz(this.startDate)}set duration(e){this.component.hasProperty("dtend")&&this.component.removeProperty("dtend"),this._setProp("duration",e)}get location(){return this._firstProp("location")}set location(e){this._setProp("location",e)}get attendees(){return this.component.getAllProperties("attendee")}get summary(){return this._firstProp("summary")}set summary(e){this._setProp("summary",e)}get description(){return this._firstProp("description")}set description(e){this._setProp("description",e)}get color(){return this._firstProp("color")}set color(e){this._setProp("color",e)}get organizer(){return this._firstProp("organizer")}set organizer(e){this._setProp("organizer",e)}get sequence(){return this._firstProp("sequence")}set sequence(e){this._setProp("sequence",e)}get recurrenceId(){return this._firstProp("recurrence-id")}set recurrenceId(e){this._setTime("recurrence-id",e)}_setTime(e,o){let u=this.component.getFirstProperty(e);u||(u=new pt(e),this.component.addProperty(u)),o.zone===c.localTimezone||o.zone===c.utcTimezone?u.removeParameter("tzid"):u.setParameter("tzid",o.zone.tzid),u.setValue(o)}_setProp(e,o){this.component.updatePropertyWithValue(e,o)}_firstProp(e){return this.component.getFirstPropertyValue(e)}toString(){return this.component.toString()}}function Dt(e,o){return e[0]>o[0]?1:o[0]>e[0]?-1:0}var St={foldLength:75,debug:!1,newLineChar:"\r\n",Binary:t,Component:yt,ComponentParser:class{constructor(e){void 0===e&&(e={});for(let[o,u]of Object.entries(e))this[o]=u}parseEvent=!0;parseTimezone=!0;oncomplete=function(){};onerror=function(e){};ontimezone=function(e){};onevent=function(e){};process(e){"string"==typeof e&&(e=l(e)),e instanceof yt||(e=new yt(e));let o,u=e.getAllSubcomponents(),b=0,w=u.length;for(;b<w;b++)switch(o=u[b],o.name){case"vtimezone":if(this.parseTimezone){let e=o.getFirstPropertyValue("tzid");e&&this.ontimezone(new c({tzid:e,component:o}))}break;case"vevent":this.parseEvent&&this.onevent(new gt(o));break;default:continue}this.oncomplete()}},Duration:r,Event:gt,Period:k,Property:pt,Recur:B,RecurExpansion:_t,RecurIterator:C,Time:s,Timezone:c,TimezoneService:v,UtcOffset:S,VCardTime:E,parse:l,stringify:ft,design:Yt,helpers:N};export{St as default};

